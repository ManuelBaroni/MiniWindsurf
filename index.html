<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windsurf Game + Debug</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh; 
            background-color: #333;
            color: #fff;
            font-family: sans-serif;
        }
        canvas {
            border: 2px solid #fff;
        }
        h1 {
            margin-bottom: 10px;
        }
        p {
            margin-top: 5px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>
<body>
    <h1>Windsurf Semplice (con Debug)</h1>
    <p>Usa ◀ FRECCIA SINISTRA e FRECCIA DESTRA ▶ per virare.</p>
    
    <script>
        // --- COSTANTI DI GIOCO ---
        const WIND_DIRECTION_DEGREES = 0; 
        const WIND_SPEED = 0.04;
        const NO_GO_ZONE_DEGREES = 20;

        // --- VARIABILI GLOBALI ---
        let board;
        let windVector;
        
        function setup() {
            createCanvas(800, 600);
            angleMode(RADIANS);

            board = {
                pos: createVector(width / 2, height / 2),
                vel: createVector(0, 0),
                angle: 0,
                turnSpeed: 0.05,
                drag: 0.98,
                sailAngle: 0,
                // Variabili per il debug
                debug_angleBetween: 0,
                debug_powerFactor: 0,
            };
            
            const windAngleRadians = radians(WIND_DIRECTION_DEGREES) - PI / 2;
            windVector = p5.Vector.fromAngle(windAngleRadians, 1);
        }

        function draw() {
            background(60, 120, 220); 

            handleInput();
            updatePhysics();
            
            drawWindsurf();
            drawWindIndicator();

            // NUOVA FUNZIONE per mostrare i dati a schermo
            drawDebugInfo(); 
        }

        function handleInput() {
            if (keyIsDown(LEFT_ARROW)) {
                board.angle -= board.turnSpeed;
            }
            if (keyIsDown(RIGHT_ARROW)) {
                board.angle += board.turnSpeed;
            }
        }

        function updatePhysics() {
            const boardDirectionVector = p5.Vector.fromAngle(board.angle - PI / 2);
            const angleBetween = boardDirectionVector.angleBetween(windVector);
            const absAngle = abs(angleBetween);

            const noGoRadians = radians(NO_GO_ZONE_DEGREES);

            let force = createVector(0, 0);
            let powerFactor = 0;

            if (absAngle < noGoRadians) {
                powerFactor = 0;
                board.sailAngle = 0;
            } else if (absAngle < radians(45)) {
                powerFactor = map(absAngle, noGoRadians, radians(45), 0, 0.4);
                board.sailAngle = -Math.sign(sin(angleBetween)) * PI / 6;
            } else if (absAngle < radians(90)) {
                powerFactor = map(absAngle, radians(45), radians(90), 0.4, 1.0);
                board.sailAngle = -Math.sign(sin(angleBetween)) * PI / 4;
            } else if (absAngle < radians(135)) {
                powerFactor = map(absAngle, radians(90), radians(135), 1.0, 0.6);
                board.sailAngle = -Math.sign(sin(angleBetween)) * PI / 3;
            } else {
                powerFactor = 0.3;
                board.sailAngle = -Math.sign(sin(angleBetween)) * PI / 3;
            }

            // Salva i valori per il debug
            board.debug_angleBetween = angleBetween;
            board.debug_powerFactor = powerFactor;

            force = boardDirectionVector.copy().mult(powerFactor * WIND_SPEED);

            board.vel.add(force);
            board.vel.mult(board.drag);
            board.pos.add(board.vel);

            if (board.pos.x > width + 20) board.pos.x = -20;
            if (board.pos.x < -20) board.pos.x = width + 20;
            if (board.pos.y > height + 20) board.pos.y = -20;
            if (board.pos.y < -20) board.pos.y = height + 20;
        }


        function drawWindsurf() {
            push();
            translate(board.pos.x, board.pos.y);
            rotate(board.angle);

            fill(240, 230, 140);
            noStroke();
            rectMode(CENTER);
            rect(0, 0, 15, 60);

            fill(210, 180, 140);
            triangle(0, -40, -7.5, -30, 7.5, -30);
            
            push();
            translate(0, 0); 
            rotate(board.sailAngle);

            fill(255, 255, 255, 200);
            stroke(50);
            strokeWeight(2);
            rect(0, -25, 4, 50);

            pop();
            pop();
        }


        function drawWindIndicator() {
            push();
            translate(50, 50);
            noFill();
            stroke(255, 255, 255, 150);
            strokeWeight(2);
            ellipse(0, 0, 40, 40);
            
            fill(255);
            noStroke();
            textAlign(CENTER, CENTER);
            text('N', 0, -28);

            rotate(radians(WIND_DIRECTION_DEGREES));
            stroke(255, 0, 0);
            strokeWeight(3);
            line(0, -10, 0, 15);
            fill(255, 0, 0);
            noStroke();
            triangle(0, 20, -5, 10, 5, 10);
            pop();
        }

        // --- NUOVA FUNZIONE DI DEBUG ---
        function drawDebugInfo() {
            // Prepara i valori da visualizzare (convertiti in gradi per leggibilità)
            const windVecAngle = degrees(windVector.heading());
            const boardAngle = degrees(board.angle % TWO_PI);
            const relativeAngle = degrees(board.debug_angleBetween);
            const sailAngle = degrees(board.sailAngle);
            const power = board.debug_powerFactor;
            const speed = board.vel.mag();

            // Impostazioni testo
            push();
            fill(255, 255, 0); // Giallo per la massima visibilità
            noStroke();
            textSize(14);
            textAlign(RIGHT, TOP);
            textFont('monospace');

            let x = width - 10;
            let y = 10;
            const lineHeight = 18;

            // Stampa i valori
            text(`--- DEBUG INFO ---`, x, y); y += lineHeight * 1.5;
            text(`Vento da (const): ${WIND_DIRECTION_DEGREES.toFixed(1)}°`, x, y); y += lineHeight;
            text(`Vettore Vento Dir: ${windVecAngle.toFixed(1)}°`, x, y); y += lineHeight;
            text(`Angolo Tavola: ${boardAngle.toFixed(1)}°`, x, y); y += lineHeight;
            text(`Angolo Tavola/Vento: ${relativeAngle.toFixed(1)}°`, x, y); y += lineHeight * 1.5;
            
            text(`Angolo Vela (rel.): ${sailAngle.toFixed(1)}°`, x, y); y += lineHeight;
            text(`Fattore Potenza: ${power.toFixed(2)}`, x, y); y += lineHeight;
            text(`Velocità: ${speed.toFixed(3)}`, x, y);

            pop();
        }
    </script>
</body>
</html>
